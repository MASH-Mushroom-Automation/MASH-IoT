## v2.7.1 (2026-02-19) - Critical Bug Fixes: MQTT Actuator Sync
Priority: high

**CRITICAL UPDATE**: Enables bidirectional MQTT communication for actuator state synchronization. Mobile apps can now receive real-time updates when actuators are manually controlled on the physical device, ensuring UI reflects actual hardware state.

### Fixed
- MQTT actuator state changes now published to mobile app subscribers
- Manual actuator control on physical device triggers MQTT broadcast
- Mobile apps receive state updates without polling HTTP endpoints
- Actuator states stay synchronized across all connected clients

### New
- `publish_actuator_state()` method in MQTTClient for broadcasting state changes
- MQTT topic: `devices/{device_id}/actuator_states`
- Payload format: `{"room": "fruiting", "actuator": "fan", "state": "on", "timestamp": 1234567890}`

### Improved
- `_update_actuator_state_from_command()` now publishes to MQTT after updating app config
- All actuator commands (HTTP, MQTT, automation) trigger state broadcasts
- Error handling for MQTT publish failures (logs warning but doesn't block operation)
- Actuator name mapping extracts room and actuator from Arduino command format

### Technical Details
- MQTT client publishes at QoS 1 (at least once delivery)
- Retain flag set to `False` (no persistent state storage on broker)
- Mobile app must subscribe to `devices/{deviceId}/actuator_states` topic
- Compatible with mobile app v1.3.5+ (requires actuator state subscription)
- Backward compatible: Works with older mobile versions (they just won't receive updates)

### Mobile App Compatibility
- **Required mobile app version:** v1.3.5+ for full bidirectional sync
- Mobile app v1.3.4 and below can send commands but won't receive state updates
- No breaking changes: HTTP endpoints still functional for polling

### Testing Notes
- Test manual switch on RPi device → verify mobile UI updates
- Test MQTT command from mobile → verify RPi publishes state after execution
- Test automation decision → verify all connected mobiles receive update
- Monitor MQTT traffic at: `devices/<device_id>/actuator_states`
