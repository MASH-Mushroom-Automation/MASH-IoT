{% extends "base.html" %}
{% block title %}WiFi Setup{% endblock %}

{% block content %}
<h1 class="page-title">WiFi Configuration</h1>

<div class="content-area">
    <!-- Current Network Status -->
    {% if current_network %}
    <div class="info-card success">
        <div class="info-header">
            <i class="fas fa-check-circle"></i>
            <h3>Currently Connected</h3>
        </div>
        <div class="info-body">
            <div class="network-name">
                <i class="fas fa-wifi"></i>
                <strong>{{ current_network }}</strong>
            </div>
            <p class="info-text">Your device is connected to this network.</p>
        </div>
    </div>
    {% else %}
    <div class="info-card warning">
        <div class="info-header">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Not Connected</h3>
        </div>
        <div class="info-body">
            <p class="info-text">No WiFi connection detected. Please connect to a network below.</p>
        </div>
    </div>
    {% endif %}

    <!-- WiFi Connection Form -->
    <div class="wifi-setup-card">
        <h2><i class="fas fa-network-wired"></i> Connect to Network</h2>
        
        <form action="{{ url_for('web.wifi_connect') }}" method="post" class="wifi-form">
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-list"></i> Select Network
                </label>
                <select name="ssid_select" class="form-control" onchange="toggleManual(this)" required>
                    {% if networks and networks|length > 0 %}
                        <option value="">-- Choose a network --</option>
                        {% for net in networks %}
                            <option value="{{ net }}">{{ net }}</option>
                        {% endfor %}
                        <option value="OTHER">✏️ Enter Manually...</option>
                    {% else %}
                        <option value="OTHER">✏️ Enter Manually...</option>
                    {% endif %}
                </select>
            </div>
            
            <div class="form-group" id="manual_ssid_group" style="display: none;">
                <label class="form-label">
                    <i class="fas fa-keyboard"></i> Network Name (SSID)
                </label>
                <input type="text" 
                       id="manual_ssid" 
                       name="manual_ssid" 
                       class="form-control"
                       placeholder="Enter network name...">
            </div>
            
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-lock"></i> Password
                </label>
                <input type="password" 
                       name="password" 
                       class="form-control"
                       placeholder="Enter WiFi password" 
                       required>
            </div>
            
            <button type="submit" class="btn-primary">
                <i class="fas fa-plug"></i> Connect to Network
            </button>
        </form>
    </div>
    
    <!-- Info Section -->
    <div class="info-card info">
        <div class="info-header">
            <i class="fas fa-info-circle"></i>
            <h3>Connection Process</h3>
        </div>
        <div class="info-body">
            <ul class="info-list">
                <li>After submitting, the device will attempt to connect to the selected network.</li>
                <li>If successful, the provisioning hotspot will disconnect.</li>
                <li>If the connection fails, the hotspot will automatically restart.</li>
                <li>Make sure you have the correct password for the network.</li>
            </ul>
        </div>
    </div>
</div>

<script>
    function toggleManual(select) {
        var manualGroup = document.getElementById("manual_ssid_group");
        var manualInput = document.getElementById("manual_ssid");
        if (select.value === "OTHER") {
            manualGroup.style.display = "block";
            manualInput.required = true;
        } else {
            manualGroup.style.display = "none";
            manualInput.required = false;
        }
    }
</script>
{% endblock %}